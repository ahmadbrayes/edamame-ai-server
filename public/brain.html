<script>

    const chat = document.getElementById("chat");
    const input = document.getElementById("input");
    const send = document.getElementById("send");

    // ðŸ”¥ SESSION ID (ÙŠØªØ°ÙƒØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)
    let sessionId = localStorage.getItem("sessionId");

    if (!sessionId) {
      sessionId = crypto.randomUUID();
      localStorage.setItem("sessionId", sessionId);
    }


    function addMsg(text, cls){
      const d = document.createElement("div");
      d.className = "msg " + cls;
      d.textContent = text;
      chat.appendChild(d);
      chat.scrollTop = chat.scrollHeight;
      return d;
    }


    async function ask(){
      const text = input.value.trim();
      if(!text) return;

      input.value = "";
      send.disabled = true;

      addMsg(text, "me");
      const waiting = addMsg("...", "ai");

      try{

        const r = await fetch("/api/chat", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ 
            message: text,
            sessionId: sessionId // ðŸ”¥ Ø£Ù‡Ù… Ø³Ø·Ø±
          })
        });

        const data = await r.json();

        waiting.textContent = data.reply || "No response.";

      }catch(e){
        waiting.textContent = "Connection error. Try again.";
      }finally{
        send.disabled = false;
        input.focus();
      }
    }


    send.addEventListener("click", ask);

    input.addEventListener("keydown", (e)=>{
      if(e.key === "Enter" && !e.shiftKey){
        e.preventDefault();
        ask();
      }
    });


    // First message
    addMsg(
      "Edamame Content Brain.\nTell me what you sell â€” and Iâ€™ll help you create content that actually drives attention.",
      "ai"
    );

</script>